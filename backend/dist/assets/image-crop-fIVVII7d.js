import{bL as se,w as P,J as Y,I as r,bM as M,bN as o,bO as Z,f as u,bP as k,bt as ee,$,bQ as G,bu as j,bR as ne,bS as C,bT as S,k as de,b0 as te,P as ve,bU as pe,U as me,bh as ie,bV as he,h as ge}from"./vendor-CdkM_rDc.js";import{V as oe,a as ue,b as be,c as ce,d as fe,e as we,_ as re,A as ye}from"./image-resize-BwgWHxnz.js";const ke={class:"tool-settings"},xe={class:"resize-mode-container"},ze=["data-mode"],Ve={class:"dimension-inputs"},_e={key:0,class:"dimensions-row"},Ee={class:"dimensions-header"},Me={class:"unit-label"},Se={class:"dimensions-inputs"},Ce={class:"input-fields"},Ie={key:0,class:"input-group"},Fe={key:1},Re={class:"slider-container"},Pe={class:"estimated-size"},Ue={class:"aspect-ratio"},$e={key:0,class:"background-fill"},Be={class:"background-header"},De={key:0,class:"color-picker-container"},Ae={class:"color-select"},Te={class:"color-value"},Le={class:"export-settings"},We={class:"target-file-size"},je={class:"input-with-unit"},Ne={class:"format-selector"},Oe=["disabled"],O=2e4,He=se({__name:"CropToolsPanel",props:{resizeMode:{},width:{},height:{},lockAspectRatio:{type:Boolean},exportFormat:{},imageElement:{},disabled:{type:Boolean}},emits:["update:resizeMode","update:width","update:height","update:lockAspectRatio","update:exportFormat","resize-image"],setup(J,{emit:K}){const l=J,s=K,I=P(()=>l.imageElement?l.imageElement.width/l.imageElement.height:1);Y(()=>l.width,t=>{if(l.lockAspectRatio&&l.imageElement){const e=Math.min(parseFloat(t)||0,O),b=parseFloat((e/I.value).toFixed(2));if(console.log("width",e,"height",b),b>O){const g=O,X=parseFloat((g*I.value).toFixed(2));s("update:width",X.toString()),s("update:height",g.toString())}else s("update:width",e.toFixed(2)),s("update:height",b.toFixed(2))}}),Y(()=>l.height,t=>{if(l.lockAspectRatio&&l.imageElement){const e=Math.min(parseFloat(t)||0,O),b=parseFloat((e*I.value).toFixed(2));if(console.log("height",e,"width",b),b>O){const g=O,X=parseFloat((g/I.value).toFixed(2));s("update:width",g.toString()),s("update:height",X.toString())}else s("update:width",b.toFixed(2)),s("update:height",e.toFixed(2))}});const f=r(50),w=P(()=>l.imageElement?{width:l.imageElement.width,height:l.imageElement.height}:{width:0,height:0});Y(f,t=>{if(!l.imageElement||l.resizeMode!=="percentage")return;const e=v(t);s("update:width",e.width.toString()),s("update:height",e.height.toString())});const V=["KB","MB"],y=r("KB"),_=[{title:"Original",value:"original"},{title:"JPG",value:"jpg"},{title:"PNG",value:"png"},{title:"WebP",value:"webp"}],E=r(_[0]);Y(E,t=>{s("update:exportFormat",t.value)});const N=r(""),B=r(!0),U=r("#895757"),H=r(!1),v=t=>{if(!l.imageElement)return{width:0,height:0};const e=t*2/100,b=Math.min(w.value.width*e,O),g=Math.min(w.value.height*e,O);return{width:Math.round(b),height:Math.round(g)}},n=()=>{const t={mode:l.resizeMode,width:parseInt(l.width),height:parseInt(l.height),lockAspectRatio:l.lockAspectRatio,backgroundColor:!l.lockAspectRatio&&B.value?U.value:void 0,format:E.value.value,targetFileSize:N.value?{size:parseInt(N.value),unit:y.value}:null,dpi:h.value!=="pixel"?parseInt(c.value):void 0};s("resize-image",t)},D=P(()=>{if(l.resizeMode==="dimensions"){const t=parseInt(l.width),e=parseInt(l.height);return t>0&&e>0}return f.value>0}),x=[{title:"pixel",value:"pixel",abbr:"px"},{title:"inch",value:"inch",abbr:"in"},{title:"centimeter",value:"centimeter",abbr:"cm"},{title:"millimeter",value:"millimeter",abbr:"mm"}],h=r("pixel"),c=r("300"),F=P(()=>h.value!=="pixel"),A=P(()=>{const t=x.find(e=>e.value===h.value);return t?t.abbr:"px"}),m=[{value:"10",label:"10 DPI (billboard)"},{value:"72",label:"72 DPI (newspaper)"},{value:"96",label:"96 DPI (screen)"},{value:"150",label:"150 DPI (magazine)"},{value:"200",label:"200 DPI (inkjet)"},{value:"240",label:"240 DPI (inkjet)"},{value:"300",label:"300 DPI (inkjet)"},{value:"360",label:"360 DPI (inkjet)"},{value:"600",label:"600 DPI (laser)"},{value:"1200",label:"1200 DPI (ultra-hires)"}],i=r(!1),d=(t,e,b,g)=>{const X=(a,Q)=>{switch(Q){case"pixel":return a;case"inch":return a*g;case"centimeter":return a/2.54*g;case"millimeter":return a/25.4*g;default:return a}},le=(a,Q)=>{switch(Q){case"pixel":return a;case"inch":return a/g;case"centimeter":return a/g*2.54;case"millimeter":return a/g*25.4;default:return a}},q=X(t,e),ae=le(q,b);return parseFloat(ae.toFixed(2))};Y([h,c],([t],[e])=>{e&&(console.log("Unit changed from",e,"to",t),console.log("Current pixel values - width:",l.width,"height:",l.height))}),Y(c,()=>{h.value!=="pixel"&&(s("update:width",l.width),s("update:height",l.height))});const p=(t,e)=>{const b=parseFloat(t)||0;if(h.value!=="pixel"){const g=d(b,h.value,"pixel",parseInt(c.value));s(`update:${e}`,g.toString())}else s(`update:${e}`,b.toString())},z=t=>{const e=parseFloat(t)||0;return h.value==="pixel"?Math.round(e).toString():d(e,"pixel",h.value,parseInt(c.value)).toFixed(2)},R=P(()=>{const t=x.find(e=>e.value===h.value);return t?` ${t.abbr}`:" px"}),T=P(()=>z(l.width)),L=P(()=>z(l.height)),W=t=>{const e=t.target;e.value=e.value.replace(/-/g,"")};return(t,e)=>{const b=C("v-icon"),g=C("v-list-item-title"),X=C("v-list-item"),le=C("v-list"),q=C("v-menu"),ae=C("v-btn");return S(),M("div",{class:Z(["tools-panel",{"tools-panel--disabled":t.disabled}])},[o("div",ke,[e[27]||(e[27]=o("h2",{class:"settings-title"},"Resize Settings",-1)),o("div",xe,[o("div",{class:"resize-mode","data-mode":t.resizeMode},[o("button",{class:Z(["mode-btn",{active:t.resizeMode==="dimensions"}]),onClick:e[0]||(e[0]=a=>t.$emit("update:resizeMode","dimensions"))}," By Dimensions ",2),o("button",{class:Z(["mode-btn",{active:t.resizeMode==="percentage"}]),onClick:e[1]||(e[1]=a=>t.$emit("update:resizeMode","percentage"))}," As Percentage ",2)],8,ze)]),o("div",Ve,[t.resizeMode==="dimensions"?(S(),M("div",_e,[o("div",Ee,[e[20]||(e[20]=o("div",{class:"dimensions-labels"},[o("label",null,"Width"),o("label",null,"Height")],-1)),o("div",Me,[u(q,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),"close-on-content-click":!0,location:"bottom end"},{activator:k(({props:a})=>[o("div",de({class:"unit-text"},a),[te(j(A.value)+" ",1),u(b,{size:"small",class:Z(["unit-arrow",{"unit-arrow-active":i.value}])},{default:k(()=>e[19]||(e[19]=[te(" mdi-chevron-down ")])),_:1},8,["class"])],16)]),default:k(()=>[u(le,{density:"compact",class:"unit-menu"},{default:k(()=>[(S(),M(ve,null,pe(x,a=>u(X,{key:a.value,value:a.value,onClick:Q=>h.value=a.value},{default:k(()=>[u(g,null,{default:k(()=>[te(j(a.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["modelValue"])])]),o("div",Se,[o("div",Ce,[u($(oe),{"model-value":T.value,disabled:t.disabled,"onUpdate:modelValue":e[3]||(e[3]=a=>p(a,"width")),onInput:W,type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"size-input",onWheel:e[4]||(e[4]=ee(()=>{},["prevent"])),onBlur:e[5]||(e[5]=a=>t.$emit("update:width",l.width))},null,8,["model-value","disabled"]),u($(oe),{"model-value":L.value,disabled:t.disabled,"onUpdate:modelValue":e[6]||(e[6]=a=>p(a,"height")),onInput:W,type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"size-input",onWheel:e[7]||(e[7]=ee(()=>{},["prevent"])),onBlur:e[8]||(e[8]=a=>t.$emit("update:height",l.height))},null,8,["model-value","disabled"])])]),F.value?(S(),M("div",Ie,[e[21]||(e[21]=o("label",null,"DPI",-1)),u($(ue),{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value=a),items:m,"item-title":"label","item-value":"value",density:"compact",variant:"outlined","hide-details":"",class:"dpi-input"},null,8,["modelValue"])])):G("",!0)])):G("",!0),t.resizeMode==="percentage"?(S(),M("div",Fe,[e[22]||(e[22]=o("label",null,"Size",-1)),o("div",Re,[u($(be),{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=a=>f.value=a),min:1,max:100,"hide-details":"",density:"compact",color:"primary","thumb-label":"","thumb-size":20},null,8,["modelValue"])]),o("div",Pe,[o("span",null,"Estimated size: "+j(T.value)+j(R.value)+" × "+j(L.value)+j(R.value),1)])])):G("",!0)]),o("div",Ue,[u($(ce),{"model-value":t.lockAspectRatio,"onUpdate:modelValue":e[11]||(e[11]=a=>t.$emit("update:lockAspectRatio",a)),label:"Lock Aspect Ratio","hide-details":"",density:"compact",color:"primary"},null,8,["model-value"])]),t.lockAspectRatio?G("",!0):(S(),M("div",$e,[o("div",Be,[u($(ce),{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=a=>B.value=a),"hide-details":"",density:"compact",color:"primary",class:"background-checkbox"},{label:k(()=>[e[23]||(e[23]=o("span",null,"Background Fill",-1)),u(ae,{icon:"mdi-help-circle-outline",variant:"text",density:"compact",size:"small",class:"help-icon"})]),_:1},8,["modelValue"])]),B.value?(S(),M("div",De,[o("div",Ae,[o("div",{class:"color-preview",style:ne({backgroundColor:U.value})},null,4),o("div",Te,j(U.value),1)]),u(q,{modelValue:H.value,"onUpdate:modelValue":e[14]||(e[14]=a=>H.value=a),"close-on-content-click":!1,location:"bottom"},{activator:k(({props:a})=>[o("div",de({class:"color-box"},a,{style:{backgroundColor:U.value}}),null,16)]),default:k(()=>[u($(fe),{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=a=>U.value=a),"hide-inputs":"","hide-canvas":"","show-swatches":""},null,8,["modelValue"])]),_:1},8,["modelValue"])])):G("",!0)])),o("div",Le,[e[26]||(e[26]=o("div",{class:"section-header"},[o("h3",null,"Export Settings"),o("button",{class:"collapse-btn"},"▼")],-1)),o("div",We,[e[24]||(e[24]=o("label",null,"Target File Size (optional)",-1)),o("div",je,[u($(oe),{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=a=>N.value=a),onInput:W,type:"number",min:"0",placeholder:"Enter size",density:"compact",variant:"outlined","hide-details":"",onWheel:e[16]||(e[16]=ee(()=>{},["prevent"])),class:"size-input"},null,8,["modelValue"]),u($(ue),{modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=a=>y.value=a),items:V,density:"compact",variant:"outlined","hide-details":"",class:"size-unit-select"},null,8,["modelValue"])])]),o("div",Ne,[e[25]||(e[25]=o("label",null,"Save Format",-1)),u($(we),{modelValue:E.value,"onUpdate:modelValue":e[18]||(e[18]=a=>E.value=a),items:_,"item-title":"title","item-value":"value",density:"compact",variant:"outlined","hide-details":"","return-object":""},null,8,["modelValue"])])]),o("button",{class:"resize-btn",onClick:n,disabled:!D.value||t.disabled}," Resize Image → ",8,Oe)])],2)}}}),Xe=re(He,[["__scopeId","data-v-b5b725d2"]]),Ye={class:"canvas-container"},Ge=["src"],Ke={key:0,class:"scale-indicator"},Je={class:"scale-value"},qe=se({__name:"CropPreviewPanel",props:{imageElement:{}},emits:["fileUpload","imageClick"],setup(J,{emit:K}){const l=J,s=r(null);r(null);const I=r(null),f=r({x:0,y:0}),w=r(1),V=r(!1),y=r({x:0,y:0}),_=r(!1),E=r(null),N=r(0),B=r(0),U=P(()=>Math.round(w.value*100)),H=P(()=>`matrix3d(
    ${w.value}, 0, 0, 0,
    0, ${w.value}, 0, 0,
    0, 0, 1, 0,
    ${f.value.x}, ${f.value.y}, 0, 1
  )`),v=i=>{if(!i.ctrlKey)return;i.preventDefault();const d=s.value;if(!d||!l.imageElement)return;const p=d.getBoundingClientRect(),z=i.clientX-p.left,R=i.clientY-p.top,T=z-f.value.x,L=R-f.value.y,W=i.deltaY>0?.9:1.1,t=Math.min(Math.max(.1,w.value*W),5),e=t/w.value,b=z-T*e,g=R-L*e;w.value=t,f.value={x:b,y:g},_.value=!0,E.value&&clearTimeout(E.value),E.value=window.setTimeout(()=>{_.value=!1},1500)},n=i=>{V.value=!0,y.value={x:i.clientX,y:i.clientY}},D=i=>{if(!V.value)return;const d=i.clientX-y.value.x,p=i.clientY-y.value.y;f.value={x:f.value.x+d,y:f.value.y+p},y.value={x:i.clientX,y:i.clientY}},x=()=>{V.value=!1},h=(i,d)=>{if(!s.value)return 1;const p=s.value.querySelector(".canvas-container");if(!p)return 1;const z=p.getBoundingClientRect(),R=40,T=z.width-R*2,L=z.height-R*2;if(i<=T&&d<=L)return 1;const W=T/i,t=L/d;return Math.min(W,t)};P(()=>{if(!l.imageElement)return{width:0,height:0,scale:1};const d=h(l.imageElement.width,l.imageElement.height)*w.value;return{width:l.imageElement.width*d,height:l.imageElement.height*d,scale:d}});const c=()=>{if(!l.imageElement||!s.value)return;const i=s.value.querySelector(".canvas-container");if(!i)return;const d=i.getBoundingClientRect(),p=40,z=d.width-p*2,R=d.height-p*2;if(w.value=1,l.imageElement.width>z||l.imageElement.height>R){const T=z/l.imageElement.width,L=R/l.imageElement.height,W=Math.min(T,L);w.value=W}f.value={x:(d.width-l.imageElement.width*w.value)/2,y:(d.height-l.imageElement.height*w.value)/2}},F=()=>{c()},A=()=>{s.value&&(N.value=s.value.clientWidth-48,B.value=s.value.clientHeight-48)},m=()=>{var i;(i=I.value)==null||i.click()};return me(()=>{A();const i=new ResizeObserver(()=>{A()});s.value&&i.observe(s.value),ie(()=>{i.disconnect()}),window.addEventListener("resize",c)}),ie(()=>{window.removeEventListener("resize",c),E.value&&clearTimeout(E.value)}),(i,d)=>(S(),M("div",{class:"preview-panel",ref_key:"previewPanelRef",ref:s,onWheel:ee(v,["prevent"])},[o("div",Ye,[i.imageElement?(S(),M("div",{key:0,class:"image-container",style:ne({cursor:V.value?"grabbing":"grab",userSelect:"none"}),onMousedown:n,onMousemove:D,onMouseup:x,onMouseleave:x},[o("img",{src:i.imageElement.src,style:ne({transform:H.value,transformOrigin:"0 0",maxWidth:"none",maxHeight:"none",willChange:"transform",transition:"transform 0.05s linear"}),onLoad:F,draggable:"false"},null,44,Ge)],36)):(S(),M("div",{key:1,class:"upload-placeholder",onClick:m},[o("input",{type:"file",ref_key:"fileInput",ref:I,onChange:d[0]||(d[0]=p=>i.$emit("fileUpload",p)),accept:"image/*",style:{display:"none"}},null,544),d[1]||(d[1]=he('<div class="upload-content" data-v-8bf3257b><svg class="upload-icon" viewBox="0 0 1024 1024" fill="currentColor" data-v-8bf3257b><path d="M200.32 318.506667a324.906667 324.906667 0 0 1 623.36 0 235.264 235.264 0 0 1-65.28 461.226666 33.621333 33.621333 0 0 1 0-67.2 168.021333 168.021333 0 0 0 31.573333-333.056 33.578667 33.578667 0 0 1-26.538666-25.685333 257.706667 257.706667 0 0 0-502.869334 0 33.578667 33.578667 0 0 1-26.538666 25.685333 168.064 168.064 0 0 0 31.573333 333.056 33.621333 33.621333 0 0 1 0 67.2 235.178667 235.178667 0 0 1-65.28-461.226666z" data-v-8bf3257b></path><path d="M489.386667 522.965333a32 32 0 0 1 45.226666 0l106.666667 106.666667a32 32 0 1 1-45.226667 45.226667l-52.053333-52.010667v264.106667a32 32 0 0 1-64 0v-264.106667l-52.053333 52.053333a32 32 0 1 1-45.226667-45.226666l106.666667-106.666667z" data-v-8bf3257b></path></svg><div class="upload-text" data-v-8bf3257b> Click or drag to upload an image <div class="upload-hint" data-v-8bf3257b> Support PNG, JPG,JPEG. Max 20 MB </div></div></div>',1))]))]),u(ge,{name:"fade"},{default:k(()=>[_.value?(S(),M("div",Ke,[o("div",Je,j(U.value)+"%",1)])):G("",!0)]),_:1})],544))}}),Qe=re(qe,[["__scopeId","data-v-8bf3257b"]]),Ze={class:"main-content"},et={class:"text-center mb-4"},tt={class:"d-flex align-center"},lt=se({__name:"CropImage",setup(J){const K=r("resize");r("zh");const l=r("dimensions"),s=r(""),I=r(""),f=r(!0),w=r("original"),V=r(null),y=r({show:!1,text:"",color:"error"}),_=r(!1),E=v=>{var D;const n=(D=v.target.files)==null?void 0:D[0];if(n){const x=new FileReader;x.onload=h=>{var F;const c=new Image;c.onload=()=>{V.value=c,s.value=c.width.toString(),I.value=c.height.toString()},c.src=(F=h.target)==null?void 0:F.result},x.readAsDataURL(n)}},N=()=>{},B=(v,n="success")=>{y.value={show:!0,text:v,color:n}},U=async v=>{try{if(!V.value)throw new Error("No image loaded");_.value=!0;const n=new FormData,x=await(await fetch(V.value.src)).blob();n.append("image",x);const h={width:v.width,height:v.height,format:v.format==="original"?"":v.format,backgroundColor:v.backgroundColor||"",quality:85,dpi:v.dpi};if(v.targetFileSize){const p={KB:1024,MB:1048576,GB:1073741824},z=v.targetFileSize.size*p[v.targetFileSize.unit];h.targetFileSize=z}n.append("data",JSON.stringify(h));const c=await fetch(`${ye}/api/image/resize`,{method:"POST",body:n});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);let F="resized_image";const A=c.headers.get("content-disposition");if(A){const p=A.match(/filename="([^"]*)"/);p&&p[1]&&(F=p[1])}const m=await c.blob(),i=window.URL.createObjectURL(m),d=document.createElement("a");d.href=i,d.download=F,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(i),document.body.removeChild(d),B("图片处理成功！","success")}catch(n){console.error("处理图片失败:",n),B(n instanceof Error?n.message:"处理图片失败，请重试","error")}finally{_.value=!1}},H=v=>{v.ctrlKey&&v.preventDefault()};return me(()=>{window.addEventListener("wheel",H,{passive:!1})}),ie(()=>{window.removeEventListener("wheel",H)}),(v,n)=>{const D=C("v-progress-circular"),x=C("v-card"),h=C("v-overlay"),c=C("v-icon"),F=C("v-btn"),A=C("v-snackbar");return S(),M("main",Ze,[u(h,{modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=m=>_.value=m),class:"align-center justify-center",persistent:"",scrim:"rgba(0,0,0,0.3)"},{default:k(()=>[u(x,{color:"white",width:"300",rounded:"lg",elevation:"8",class:"pa-4"},{default:k(()=>[o("div",et,[u(D,{indeterminate:"",color:"primary",size:"64"})]),n[9]||(n[9]=o("div",{class:"text-center text-body-1"}," 处理图片中... ",-1))]),_:1})]),_:1},8,["modelValue"]),u(Xe,{currentTool:K.value,"onUpdate:currentTool":n[1]||(n[1]=m=>K.value=m),resizeMode:l.value,"onUpdate:resizeMode":n[2]||(n[2]=m=>l.value=m),width:s.value,"onUpdate:width":n[3]||(n[3]=m=>s.value=m),height:I.value,"onUpdate:height":n[4]||(n[4]=m=>I.value=m),lockAspectRatio:f.value,"onUpdate:lockAspectRatio":n[5]||(n[5]=m=>f.value=m),exportFormat:w.value,"onUpdate:exportFormat":n[6]||(n[6]=m=>w.value=m),imageElement:V.value,disabled:_.value,onResizeImage:U},null,8,["currentTool","resizeMode","width","height","lockAspectRatio","exportFormat","imageElement","disabled"]),u(Qe,{imageElement:V.value,onFileUpload:E,onImageClick:N},null,8,["imageElement"]),u(A,{modelValue:y.value.show,"onUpdate:modelValue":n[8]||(n[8]=m=>y.value.show=m),color:y.value.color,timeout:3e3,location:"top",elevation:"4",rounded:"lg",class:"custom-snackbar"},{actions:k(()=>[u(F,{color:"white",variant:"text",onClick:n[7]||(n[7]=m=>y.value.show=!1)},{default:k(()=>n[10]||(n[10]=[te(" 关闭 ")])),_:1})]),default:k(()=>[o("div",tt,[u(c,{icon:y.value.color==="error"?"mdi-alert-circle":"mdi-check-circle",class:"me-2"},null,8,["icon"]),o("span",null,j(y.value.text),1)])]),_:1},8,["modelValue","color"])])}}}),nt=re(lt,[["__scopeId","data-v-423d145b"]]);export{nt as C};
