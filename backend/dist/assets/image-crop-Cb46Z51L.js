import{bL as $,I as w,w as V,bM as X,bN as l,f,bt as y,bP as E,b0 as T,bO as j,bS as I,bT as _,J as G,U as N,bh as O,bR as J,bV as H,bu as K}from"./vendor-CdkM_rDc.js";import{_ as L,A as Q}from"./image-resize-D2DSGeoO.js";const Z={class:"tool-settings"},ee={class:"dimension-inputs"},te={class:"dimensions-row"},ie={class:"dimensions-inputs"},oe={class:"input-fields"},ne={class:"aspect-ratio-select"},le={class:"crop-position"},ae={class:"position-inputs"},se={class:"input-group"},de={class:"input-group"},re={class:"action-buttons"},ue=["disabled"],ce=["disabled"],pe=["disabled"],ve=$({__name:"CropToolsPanel",props:{width:{},height:{},positionX:{},positionY:{},disabled:{type:Boolean}},emits:["update:width","update:height","update:positionX","update:positionY","resize-image","crop","reset"],setup(W,{emit:F}){const g=W,p=F,U=[{title:"FreeForm",value:"freeform"},{title:"Original",value:"original"},{title:"Custom",value:"custom"},{title:"1:1 (Square)",value:"1:1"},{title:"4:3 (Monitor)",value:"4:3"},{title:"14:9",value:"14:9"},{title:"16:9 (Widescreen)",value:"16:9"},{title:"16:10",value:"16:10"},{title:"2:1",value:"2:1"},{title:"3:1 (Panaroma)",value:"3:1"},{title:"4:1",value:"4:1"},{title:"3:2 (35mm film)",value:"3:2"},{title:"5:4",value:"5:4"},{title:"7:5",value:"7:5"},{title:"19:10",value:"19:10"},{title:"21:9 (Cinemascope)",value:"21:9"},{title:"32:9 (Super Ultra Wide)",value:"32:9"},{title:"Facebook profile 170x170",value:"170:170"},{title:"Facebook cover 820x312",value:"820:312"},{title:"Facebook post 1200x900",value:"1200:900"},{title:"Facebook ad 1280x720",value:"1280:720"},{title:"Instagram profile 110x110",value:"110:110"},{title:"Instagram post 320x320",value:"320:320"},{title:"Instagram story 1080x1920",value:"1080:1920"},{title:"Twitter profile 400x400",value:"400:400"},{title:"Twitter header 1500x1500",value:"1500:1500"},{title:"Twitter image 1024x512",value:"1024:512"},{title:"Twitter card 1200x628",value:"1200:628"},{title:"Twitter ad 1200x675",value:"1200:675"},{title:"Youtube profile 800x800",value:"800:800"},{title:"Youtube channel art 2560x1440",value:"2560:1440"},{title:"Youtube thumb 1280x720",value:"1280:720"},{title:"Web mini 1024x768",value:"1024:768"},{title:"Web small 1280x800",value:"1280:800"},{title:"Web common 1366x768",value:"1366:768"},{title:"Web medium 1440x900",value:"1440:900"},{title:"Fll HD 1920x1080",value:"1920:1080"},{title:"Ultra HD 4x 3840x2160",value:"3840:2160"},{title:"Paper A4 2480x3508",value:"2480:3508"},{title:"Paper A5 1748x2480",value:"1748:2480"},{title:"Paper A6 1280x1748",value:"1280:1748"},{title:"Paper letter 2400x3300",value:"2400:3300"}],b=w("freeform"),v=V(()=>g.width),R=V(()=>g.height),k=V(()=>g.positionX),C=V(()=>g.positionY),P=V(()=>{const i=parseInt(g.width),t=parseInt(g.height);return i>0&&t>0}),Y=i=>{if(i==="freeform"||i==="original")return;const[t,s]=i.split(":").map(Number);t&&s&&(p("update:width",t.toString()),p("update:height",s.toString()))},m=(i,t)=>{const s=parseFloat(i)||0;switch(t){case"width":p("update:width",s.toString());break;case"height":p("update:height",s.toString());break;case"positionX":p("update:positionX",s.toString());break;case"positionY":p("update:positionY",s.toString());break}},S=i=>{const t=i.target;t.value=t.value.replace(/-/g,"")},z=()=>{p("resize-image",{width:parseInt(g.width),height:parseInt(g.height)})},n=()=>{p("crop")},e=()=>{p("reset")};return(i,t)=>{const s=I("v-text-field"),a=I("v-select"),c=I("v-icon");return _(),X("div",{class:j(["tools-panel",{"tools-panel--disabled":i.disabled}])},[l("div",Z,[t[16]||(t[16]=l("h2",{class:"settings-title"},"Crop Rectangle",-1)),l("div",ee,[l("div",te,[t[9]||(t[9]=l("div",{class:"dimensions-header"},[l("div",{class:"dimensions-labels"},[l("label",null,"Width"),l("label",null,"Height")])],-1)),l("div",ie,[l("div",oe,[f(s,{"model-value":v.value,disabled:i.disabled,"onUpdate:modelValue":t[0]||(t[0]=u=>m(u,"width")),onInput:S,type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"size-input",onWheel:t[1]||(t[1]=y(()=>{},["prevent"]))},null,8,["model-value","disabled"]),f(s,{"model-value":R.value,disabled:i.disabled,"onUpdate:modelValue":t[2]||(t[2]=u=>m(u,"height")),onInput:S,type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"size-input",onWheel:t[3]||(t[3]=y(()=>{},["prevent"]))},null,8,["model-value","disabled"])])])])]),l("div",ne,[t[10]||(t[10]=l("label",null,"Aspect Ratio",-1)),f(a,{modelValue:b.value,"onUpdate:modelValue":[t[4]||(t[4]=u=>b.value=u),Y],items:U,"item-title":"title","item-value":"value",disabled:i.disabled,density:"compact",variant:"outlined","hide-details":"",class:"ratio-select"},null,8,["modelValue","disabled"])]),l("div",le,[t[13]||(t[13]=l("h3",{class:"section-title"},"Crop Position",-1)),l("div",ae,[l("div",se,[t[11]||(t[11]=l("label",null,"Position (X)",-1)),f(s,{"model-value":k.value,disabled:i.disabled,"onUpdate:modelValue":t[5]||(t[5]=u=>m(u,"positionX")),onInput:S,type:"number",density:"compact",variant:"outlined","hide-details":"",class:"position-input",onWheel:t[6]||(t[6]=y(()=>{},["prevent"]))},null,8,["model-value","disabled"])]),l("div",de,[t[12]||(t[12]=l("label",null,"Position (Y)",-1)),f(s,{"model-value":C.value,disabled:i.disabled,"onUpdate:modelValue":t[7]||(t[7]=u=>m(u,"positionY")),onInput:S,type:"number",density:"compact",variant:"outlined","hide-details":"",class:"position-input",onWheel:t[8]||(t[8]=y(()=>{},["prevent"]))},null,8,["model-value","disabled"])])])]),l("div",re,[l("button",{class:"crop-btn",onClick:n,disabled:i.disabled},[f(c,{size:"small",class:"me-1"},{default:E(()=>t[14]||(t[14]=[T("mdi-crop")])),_:1}),t[15]||(t[15]=T(" Crop "))],8,ue),l("button",{class:"reset-btn",onClick:e,disabled:i.disabled}," Reset ",8,ce)]),l("button",{class:"resize-btn",onClick:z,disabled:!P.value||i.disabled}," Resize Image → ",8,pe)])],2)}}}),me=L(ve,[["__scopeId","data-v-ecc51f3c"]]),he={class:"canvas-container"},ge={key:0,class:"image-container"},we=["src"],fe=$({__name:"CropPreviewPanel",props:{imageElement:{}},emits:["fileUpload","imageClick"],setup(W,{emit:F}){const g=W,p=w(null),U=w(null),b=w({x:0,y:0,width:0,height:0}),v=w({isDragging:!1,startX:0,startY:0,handle:""}),R=n=>{var B;if(!g.imageElement)return n;const e=(B=p.value)==null?void 0:B.querySelector(".image-container");if(!e)return n;const i=e.querySelector("img");if(!i)return n;const t=i.getBoundingClientRect(),s=e.getBoundingClientRect(),a=t.left-s.left,c=t.top-s.top,u=a+t.width,d=c+t.height,o=20;let{x:r,y:h,width:x,height:M}=n;return x=Math.max(o,Math.min(x,u-a)),M=Math.max(o,Math.min(M,d-c)),r=Math.min(Math.max(r,a),u-x),h=Math.min(Math.max(h,c),d-M),v.value.handle.includes("w")&&r<a&&(x=x-(a-r),r=a),v.value.handle.includes("n")&&h<c&&(M=M-(c-h),h=c),v.value.handle.includes("e")&&r+x>u&&(x=u-r),v.value.handle.includes("s")&&h+M>d&&(M=d-h),{x:r,y:h,width:x,height:M}},k=n=>{var h;if(!v.value.isDragging)return;const e=n.clientX-v.value.startX,i=n.clientY-v.value.startY,t=(h=p.value)==null?void 0:h.querySelector(".image-container"),s=t==null?void 0:t.querySelector("img");if(!t||!s)return;const a=s.getBoundingClientRect(),c=t.getBoundingClientRect(),u=a.left-c.left,d=a.top-c.top;u+a.width,d+a.height;let o={...b.value};const r=20;switch(v.value.handle){case"move":o.x+=e,o.y+=i;break;case"nw":const x=Math.max(r,o.width-e),M=Math.max(r,o.height-i);o.x+=o.width-x,o.y+=o.height-M,o.width=x,o.height=M;break;case"n":const B=Math.max(r,o.height-i);o.y+=o.height-B,o.height=B;break;case"ne":o.width=Math.max(r,o.width+e);const A=Math.max(r,o.height-i);o.y+=o.height-A,o.height=A;break;case"w":const q=Math.max(r,o.width-e);o.x+=o.width-q,o.width=q;break;case"e":o.width=Math.max(r,o.width+e);break;case"sw":const D=Math.max(r,o.width-e);o.x+=o.width-D,o.width=D,o.height=Math.max(r,o.height+i);break;case"s":o.height=Math.max(r,o.height+i);break;case"se":o.width=Math.max(r,o.width+e),o.height=Math.max(r,o.height+i);break}b.value=R(o),v.value.startX=n.clientX,v.value.startY=n.clientY},C=n=>{v.value.isDragging&&requestAnimationFrame(()=>{k(n)})},P=()=>{var o;if(!g.imageElement)return;const n=(o=p.value)==null?void 0:o.querySelector(".image-container");if(!n)return;const e=n.querySelector("img");if(!e)return;const i=e.getBoundingClientRect(),t=n.getBoundingClientRect(),s=.8,a=i.width*s,c=i.height*s,u=i.left-t.left+(i.width-a)/2,d=i.top-t.top+(i.height-c)/2;b.value={x:u,y:d,width:a,height:c}},Y=()=>{requestAnimationFrame(()=>{P()})},m=(n,e)=>{v.value={isDragging:!0,startX:n.clientX,startY:n.clientY,handle:e}},S=()=>{v.value.isDragging=!1},z=()=>{var n;(n=U.value)==null||n.click()};return G(()=>g.imageElement,n=>{n&&P()}),N(()=>{window.addEventListener("mousemove",C),window.addEventListener("mouseup",S)}),O(()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",S)}),(n,e)=>(_(),X("div",{class:"preview-panel",ref_key:"previewPanelRef",ref:p},[l("div",he,[n.imageElement?(_(),X("div",ge,[l("img",{src:n.imageElement.src,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},draggable:"false",onLoad:Y},null,40,we),l("div",{class:"crop-box",style:J({left:`${b.value.x}px`,top:`${b.value.y}px`,width:`${b.value.width}px`,height:`${b.value.height}px`}),onMousedown:e[8]||(e[8]=i=>m(i,"move"))},[e[10]||(e[10]=H('<div class="grid-lines" data-v-40ec49df><div class="grid-line vertical" style="left:33.33%;" data-v-40ec49df></div><div class="grid-line vertical" style="left:66.66%;" data-v-40ec49df></div><div class="grid-line horizontal" style="top:33.33%;" data-v-40ec49df></div><div class="grid-line horizontal" style="top:66.66%;" data-v-40ec49df></div></div>',1)),l("div",{class:"handle nw",onMousedown:e[0]||(e[0]=y(i=>m(i,"nw"),["stop"]))},null,32),l("div",{class:"handle n",onMousedown:e[1]||(e[1]=y(i=>m(i,"n"),["stop"]))},null,32),l("div",{class:"handle ne",onMousedown:e[2]||(e[2]=y(i=>m(i,"ne"),["stop"]))},null,32),l("div",{class:"handle w",onMousedown:e[3]||(e[3]=y(i=>m(i,"w"),["stop"]))},null,32),l("div",{class:"handle e",onMousedown:e[4]||(e[4]=y(i=>m(i,"e"),["stop"]))},null,32),l("div",{class:"handle sw",onMousedown:e[5]||(e[5]=y(i=>m(i,"sw"),["stop"]))},null,32),l("div",{class:"handle s",onMousedown:e[6]||(e[6]=y(i=>m(i,"s"),["stop"]))},null,32),l("div",{class:"handle se",onMousedown:e[7]||(e[7]=y(i=>m(i,"se"),["stop"]))},null,32)],36)])):(_(),X("div",{key:1,class:"upload-placeholder",onClick:z},[l("input",{type:"file",ref_key:"fileInput",ref:U,onChange:e[9]||(e[9]=i=>n.$emit("fileUpload",i)),accept:"image/*",style:{display:"none"}},null,544),e[11]||(e[11]=H('<div class="upload-content" data-v-40ec49df><svg class="upload-icon" viewBox="0 0 1024 1024" fill="currentColor" data-v-40ec49df><path d="M200.32 318.506667a324.906667 324.906667 0 0 1 623.36 0 235.264 235.264 0 0 1-65.28 461.226666 33.621333 33.621333 0 0 1 0-67.2 168.021333 168.021333 0 0 0 31.573333-333.056 33.578667 33.578667 0 0 1-26.538666-25.685333 257.706667 257.706667 0 0 0-502.869334 0 33.578667 33.578667 0 0 1-26.538666 25.685333 168.064 168.064 0 0 0 31.573333 333.056 33.621333 33.621333 0 0 1 0 67.2 235.178667 235.178667 0 0 1-65.28-461.226666z" data-v-40ec49df></path><path d="M489.386667 522.965333a32 32 0 0 1 45.226666 0l106.666667 106.666667a32 32 0 1 1-45.226667 45.226667l-52.053333-52.010667v264.106667a32 32 0 0 1-64 0v-264.106667l-52.053333 52.053333a32 32 0 1 1-45.226667-45.226666l106.666667-106.666667z" data-v-40ec49df></path></svg><div class="upload-text" data-v-40ec49df> Click or drag to upload an image <div class="upload-hint" data-v-40ec49df> Support PNG, JPG,JPEG. Max 20 MB </div></div></div>',1))]))])],512))}}),be=L(fe,[["__scopeId","data-v-40ec49df"]]),xe={class:"main-content"},ye={class:"text-center mb-4"},ke={class:"d-flex align-center"},Me=$({__name:"CropImage",setup(W){const F=w("resize");w("zh");const g=w("dimensions"),p=w(""),U=w(""),b=w(!0),v=w("original"),R=w(null),k=w({show:!1,text:"",color:"error"}),C=w(!1),P=n=>{var i;const e=(i=n.target.files)==null?void 0:i[0];if(e){const t=new FileReader;t.onload=s=>{var c;const a=new Image;a.onload=()=>{R.value=a,p.value=a.width.toString(),U.value=a.height.toString()},a.src=(c=s.target)==null?void 0:c.result},t.readAsDataURL(e)}},Y=()=>{},m=(n,e="success")=>{k.value={show:!0,text:n,color:e}},S=async n=>{try{if(!R.value)throw new Error("No image loaded");C.value=!0;const e=new FormData,t=await(await fetch(R.value.src)).blob();e.append("image",t);const s={width:n.width,height:n.height,format:n.format==="original"?"":n.format,backgroundColor:n.backgroundColor||"",quality:85,dpi:n.dpi};if(n.targetFileSize){const h={KB:1024,MB:1048576,GB:1073741824},x=n.targetFileSize.size*h[n.targetFileSize.unit];s.targetFileSize=x}e.append("data",JSON.stringify(s));const a=await fetch(`${Q}/api/image/resize`,{method:"POST",body:e});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let c="resized_image";const u=a.headers.get("content-disposition");if(u){const h=u.match(/filename="([^"]*)"/);h&&h[1]&&(c=h[1])}const d=await a.blob(),o=window.URL.createObjectURL(d),r=document.createElement("a");r.href=o,r.download=c,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),document.body.removeChild(r),m("图片处理成功！","success")}catch(e){console.error("处理图片失败:",e),m(e instanceof Error?e.message:"处理图片失败，请重试","error")}finally{C.value=!1}},z=n=>{n.ctrlKey&&n.preventDefault()};return N(()=>{window.addEventListener("wheel",z,{passive:!1})}),O(()=>{window.removeEventListener("wheel",z)}),(n,e)=>{const i=I("v-progress-circular"),t=I("v-card"),s=I("v-overlay"),a=I("v-icon"),c=I("v-btn"),u=I("v-snackbar");return _(),X("main",xe,[f(s,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=d=>C.value=d),class:"align-center justify-center",persistent:"",scrim:"rgba(0,0,0,0.3)"},{default:E(()=>[f(t,{color:"white",width:"300",rounded:"lg",elevation:"8",class:"pa-4"},{default:E(()=>[l("div",ye,[f(i,{indeterminate:"",color:"primary",size:"64"})]),e[9]||(e[9]=l("div",{class:"text-center text-body-1"}," 处理图片中... ",-1))]),_:1})]),_:1},8,["modelValue"]),f(me,{currentTool:F.value,"onUpdate:currentTool":e[1]||(e[1]=d=>F.value=d),resizeMode:g.value,"onUpdate:resizeMode":e[2]||(e[2]=d=>g.value=d),width:p.value,"onUpdate:width":e[3]||(e[3]=d=>p.value=d),height:U.value,"onUpdate:height":e[4]||(e[4]=d=>U.value=d),lockAspectRatio:b.value,"onUpdate:lockAspectRatio":e[5]||(e[5]=d=>b.value=d),exportFormat:v.value,"onUpdate:exportFormat":e[6]||(e[6]=d=>v.value=d),imageElement:R.value,disabled:C.value,onResizeImage:S},null,8,["currentTool","resizeMode","width","height","lockAspectRatio","exportFormat","imageElement","disabled"]),f(be,{imageElement:R.value,onFileUpload:P,onImageClick:Y},null,8,["imageElement"]),f(u,{modelValue:k.value.show,"onUpdate:modelValue":e[8]||(e[8]=d=>k.value.show=d),color:k.value.color,timeout:3e3,location:"top",elevation:"4",rounded:"lg",class:"custom-snackbar"},{actions:E(()=>[f(c,{color:"white",variant:"text",onClick:e[7]||(e[7]=d=>k.value.show=!1)},{default:E(()=>e[10]||(e[10]=[T(" 关闭 ")])),_:1})]),default:E(()=>[l("div",ke,[f(a,{icon:k.value.color==="error"?"mdi-alert-circle":"mdi-check-circle",class:"me-2"},null,8,["icon"]),l("span",null,K(k.value.text),1)])]),_:1},8,["modelValue","color"])])}}}),Se=L(Me,[["__scopeId","data-v-423d145b"]]);export{Se as C};
